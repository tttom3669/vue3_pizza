import{l as C,c as y}from"./cartStore-89117445.js";import{_ as E,R as A,m as w,a as g,r as i,o as c,c as u,b as e,d as r,F as x,e as B,g as D,i as f,H as F,h as V,t as d,w as k,f as M,n as v,v as T}from"./index-9b93be38.js";import{s as R}from"./swalMessage-9fc1a9a1.js";import{P as q}from"./ProgressBar-89f1f19b.js";const{VITE_APP_URL:U,VITE_APP_PATH:L}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},m=C(),O={data(){return{userForm:{user:{name:"",email:"",tel:"",address:"",paymentMethod:"信用卡",pickupMethod:"到店自取",cartDeliveryFee:0},message:""},coupon_code:""}},components:{ProgressBar:q,RouterLink:A},watch:{deliveryFee(){this.userForm.user.cartDeliveryFee=this.deliveryFee}},computed:{...w(y,["cart"]),...w(C,["isLoading"]),deliveryFee(){return this.userForm.user.pickupMethod==="到店自取"||this.cart.total>=399?0:70}},methods:{...g(R,["swalShow"]),...g(y,["getCart"]),createOrder(){const l=`${U}/api/${L}/order`,s=this.userForm;m.isLoading=!0,this.$http.post(l,{data:s}).then(n=>{const{message:b,orderId:t}=n.data;m.isLoading=!1,this.swalShow(`${b}`,"success","toast"),this.$router.push(`/checkout/${t}`)}).catch(n=>{m.isLoading=!1,this.swalShow(`${n.response.data.message}`,"error")})},addCouponCode(){const l=`${U}/api/${L}/coupon`,s={code:this.coupon_code};m.isLoading=!0,this.$http.post(l,{data:s}).then(n=>{m.isLoading=!1,this.getCart(),this.swalShow(`${n.data.message}`,"success","toast")}).catch(n=>{m.isLoading=!1,this.swalShow(`${n.response.data.message}`,"error")})}},mounted(){this.getCart()}},G={class:"bg_texture3"},H={class:"container mb-5"},$={class:"row mt-4"},j={class:"col-md-5"},z={class:"card"},J={class:"card-body"},K=e("h5",{class:"card-title"},"訂單明細",-1),Q={key:0,class:"table align-middle"},W=["src","alt"],X={class:"p-2"},Y={class:"d-flex flex-column"},Z={class:"text-nowrap mb-1"},ee={class:"text-nowrap mb-1"},se={class:"text-nowrap p-2"},oe={class:"text-nowrap p-2"},te={key:0},le=e("small",{class:"text-success"},"折扣價：",-1),ae=e("span",null,null,-1),re={key:1},de={class:"row row-cols-2 d-flex justify-content-between"},ne={class:"input-group mb-3"},ie=["disabled"],ce=e("div",{class:"py-2 col text-cusGray fw-bold text-start"},"小計",-1),ue={class:"py-2 col text-cusGray fw-bold text-end"},me=e("div",{class:"py-2 col text-cusGray fw-bold text-start"},"運費",-1),pe={class:"py-2 col text-cusGray fw-bold text-end"},_e=e("div",{class:"py-2 col text-success fw-bold text-start border-bottom"}," 優惠折抵 ",-1),he={class:"py-2 col text-success fw-bold text-end border-bottom"},fe=e("div",{class:"col py-2 h5 text-cusDarkBrown fw-bold text-start"}," 總計 ",-1),ve={class:"col py-2 h5 text-cusDarkBrown fw-bold text-end"},be={class:"col-md-7"},ye=e("h4",{class:"h4 text-center my-3 mt-md-0"},"訂單資訊",-1),we={class:"row d-flex flex-row mb-3"},ge={class:"col-md-6"},xe=e("label",{for:"InputUserName",class:"form-label"},"收件人姓名",-1),Fe={class:"col-md-6"},Ve=e("label",{for:"InputUserTel",class:"form-label"},"收件人電話",-1),ke={class:"row mb-3"},Me={class:"col-md-6"},Te=e("label",{for:"email",class:"form-label"},"Email",-1),Ue={class:"col-md-6"},Le=e("label",{for:"paymentMethod",class:"form-label"},"付款方式",-1),Ce=e("option",{value:"信用卡"},"信用卡",-1),Pe=e("option",{value:"現金付款"},"現金付款",-1),Se=[Ce,Pe],Ie={class:"row mb-3"},Ne={class:"col-md-6"},Ee=e("label",{for:"InputUserAddress",class:"form-label"},"收件人地址",-1),Ae={class:"col-md-6"},Be=e("label",{for:"pickupMethod",class:"form-label"},"取貨方式",-1),De=e("option",{value:"到店自取"},"到店自取",-1),Re=e("option",{value:"外送/宅配上門"},"外送/宅配上門",-1),qe=[De,Re],Oe={class:"mb-3"},Ge=e("label",{for:"FormControlTextarea",class:"form-label"},"備註",-1),He=e("div",{class:"d-flex justify-content-end"},[e("button",{type:"submit",class:"btn btn-primary text-white w-50 w-md-25"}," 下一步 ")],-1);function $e(l,s,n,b,t,p){const P=i("ProgressBar"),S=i("RouterLink"),_=i("VField"),h=i("ErrorMessage"),I=i("VForm"),N=i("VueLoading");return c(),u(x,null,[e("div",G,[e("div",H,[r(P,{stage:2}),e("div",$,[e("div",j,[e("div",z,[e("div",J,[K,l.cart.carts?(c(),u("table",Q,[e("tbody",null,[(c(!0),u(x,null,B(l.cart.carts,o=>(c(),u("tr",{key:o.id},[e("td",null,[e("img",{src:o.product.imageUrl,alt:o.product.title,class:"object-fit-cover",height:"70",width:"70"},null,8,W)]),e("td",X,[e("div",Y,[e("div",Z,[r(S,{to:`/product/${o.product.id}`,class:"text-decoration-none text-cusDarkBrown",onClick:V(()=>l.getProduct(o.product.id),["prevent"])},{default:k(()=>[M(d(o.product.title),1)]),_:2},1032,["to","onClick"])]),e("div",ee," NT$ "+d(o.product.price)+" / "+d(o.product.unit),1)])]),e("td",se,"x "+d(o.qty),1),e("td",oe,[l.cart.final_total!==l.cart.total?(c(),u("div",te,[le,ae,M(" NT$ "+d(l.$filters.currency(o.final_total)),1)])):(c(),u("div",re,"NT$ "+d(o.total),1))])]))),128))])])):D("",!0),e("div",de,[e("div",ne,[f(e("input",{type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","aria-label":"Recipient's coupon","aria-describedby":"couponInput","onUpdate:modelValue":s[0]||(s[0]=o=>t.coupon_code=o)},null,512),[[F,t.coupon_code]]),e("button",{class:"btn btn-outline-primary",type:"button",id:"couponInput",onClick:s[1]||(s[1]=V(()=>p.addCouponCode(),["prevent"])),disabled:t.coupon_code===""}," 套用優惠券碼 ",8,ie)]),ce,e("div",ue," NT$ "+d(l.cart.total),1),me,e("div",pe," +NT$ "+d(p.deliveryFee),1),_e,e("div",he," -NT$ "+d(l.cart.final_total-l.cart.total),1),fe,e("div",ve," NT$ "+d(l.cart.final_total+p.deliveryFee),1)])])])]),e("div",be,[ye,r(I,{onSubmit:p.createOrder},{default:k(({errors:o})=>[e("div",we,[e("div",ge,[xe,r(_,{type:"text",name:"姓名",class:v(["form-control",{"is-invalid":o.姓名}]),rules:"required",id:"InputUserName",placeholder:"請輸入姓名",modelValue:t.userForm.user.name,"onUpdate:modelValue":s[2]||(s[2]=a=>t.userForm.user.name=a)},null,8,["class","modelValue"]),r(h,{name:"姓名",class:"invalid-feedback"})]),e("div",Fe,[Ve,r(_,{type:"tel",name:"電話",class:v(["form-control",{"is-invalid":o.電話}]),rules:"required|min:8|max:10",id:"InputUserTel",placeholder:"請輸入電話",modelValue:t.userForm.user.tel,"onUpdate:modelValue":s[3]||(s[3]=a=>t.userForm.user.tel=a)},null,8,["class","modelValue"]),r(h,{name:"電話",class:"invalid-feedback"})])]),e("div",ke,[e("div",Me,[Te,r(_,{type:"email",name:"email",class:v(["form-control",{"is-invalid":o.email}]),id:"email",rules:"email|required","aria-describedby":"emailHelp",placeholder:"請輸入 Email",modelValue:t.userForm.user.email,"onUpdate:modelValue":s[4]||(s[4]=a=>t.userForm.user.email=a)},null,8,["class","modelValue"]),r(h,{name:"email",class:"invalid-feedback"})]),e("div",Ue,[Le,f(e("select",{class:"form-control",name:"paymentMethod",id:"paymentMethod","onUpdate:modelValue":s[5]||(s[5]=a=>t.userForm.user.paymentMethod=a)},Se,512),[[T,t.userForm.user.paymentMethod]])])]),e("div",Ie,[e("div",Ne,[Ee,r(_,{type:"text",name:"地址",class:v([{"is-invalid":o.地址},"form-control"]),rules:"required",id:"InputUserAddress",placeholder:"請輸入地址",modelValue:t.userForm.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>t.userForm.user.address=a)},null,8,["class","modelValue"]),r(h,{name:"地址",class:"invalid-feedback"})]),e("div",Ae,[Be,f(e("select",{class:"form-control",name:"pickupMethod",id:"pickupMethod","onUpdate:modelValue":s[7]||(s[7]=a=>t.userForm.user.pickupMethod=a)},qe,512),[[T,t.userForm.user.pickupMethod]])])]),e("div",Oe,[Ge,f(e("textarea",{class:"form-control",id:"FormControlTextarea",placeholder:"歡迎留下想對我們說的話!",rows:"3","onUpdate:modelValue":s[8]||(s[8]=a=>t.userForm.message=a)},null,512),[[F,t.userForm.message]])]),He]),_:1},8,["onSubmit"])])])])]),r(N,{active:l.isLoading,"onUpdate:active":s[9]||(s[9]=o=>l.isLoading=o),loader:"dots"},null,8,["active"])],64)}const Qe=E(O,[["render",$e]]);export{Qe as default};
