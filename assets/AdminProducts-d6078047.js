import{S as L}from"./SharedPagination-1e9b0c79.js";import{M as T,D as A}from"./DelItemModal-57240bf6.js";import{a as M,_ as k,r as h,o as i,c as d,b as e,d as a,w as E,i as p,H as b,F as y,e as I,g as U,n as g,v as S,I as F,t as P}from"./index-8e9926ef.js";import{s as C}from"./swalMessage-d7375910.js";const{VITE_APP_URL:D,VITE_APP_PATH:N}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},$={data(){return{modal:{},tempProduct:{}}},props:{product:{type:Object,default(){return{}}},isNew:{type:Boolean,default(){return!0}}},watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])}},methods:{...M(C,["swalShow"]),openModal(){this.modal.show()},closeModal(){this.modal.hide()},uploadFile(){const l=this.$refs.mainImgFile.files[0],t=new FormData;t.append("mainImgFile",l),this.$http.post(`${D}/api/${N}/admin/upload`,t).then(n=>{this.tempProduct.imageUrl=n.data.imageUrl,this.$refs.mainImgFile.value="",this.swalShow("圖片上傳成功","success","toast")}).catch(()=>{this.swalShow("檔案格式不符","error")})}},mounted(){this.modal=new T(this.$refs.productModal)}},R={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-xl"},H={class:"modal-content border-0"},q={class:"modal-header bg-dark text-white"},z={id:"productModalLabel",class:"modal-title"},O={key:0},j={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-2"},X=e("h3",{class:"mb-3"},"主要圖片",-1),Y={class:"mb-3"},Z=e("label",{for:"imageUrl",class:"form-label"},"圖片網址",-1),ee={class:"mb-3"},te=e("label",{for:"mainImgFile",class:"form-label"},"或 上傳圖片",-1),oe=["src"],se=e("h3",{class:"mb-3"},"多圖新增",-1),le=e("label",{for:"imageUrl",class:"form-label"},"圖片網址",-1),ie=["onUpdate:modelValue"],de=["src","alt"],ae={class:"col-sm-8"},ne={class:"row mb-3"},re={class:"col-6"},ce=e("label",{for:"title",class:"form-label"},"標題",-1),me={class:"col-6"},ue=e("label",{for:"enTitle",class:"form-label"},"英文標題",-1),pe={class:"mb-3"},he=e("label",{for:"category",class:"form-label"},"分類",-1),_e={class:"row"},be={class:"mb-3 col-md-6"},ge=e("label",{for:"productCategory",class:"form-label"},"細項分類",-1),Pe=e("option",{selected:"",disabled:"",hidden:""},"無細項分類",-1),fe=e("option",{value:"無肉不歡"},"無肉不歡",-1),ve=e("option",{value:"蔬食首選"},"蔬食首選",-1),ye=e("option",{value:"海鮮至上"},"海鮮至上",-1),we=e("option",{value:"甜食主義"},"甜食主義",-1),Ue=e("option",{value:"炸物"},"炸物",-1),Ve=e("option",{value:"飲料"},"飲料",-1),Me={class:"mb-3 col-md-6"},ke=e("label",{for:"price",class:"form-label"},"單位",-1),Ie={class:"row"},Ce={class:"mb-3 col-md-6"},xe=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Le={class:"mb-3 col-md-6"},Te=e("label",{for:"price",class:"form-label"},"售價",-1),Ae=e("hr",null,null,-1),Ee={class:"mb-3"},Se=e("label",{for:"description",class:"form-label"},"產品描述",-1),Fe={class:"mb-3"},De=e("label",{for:"content",class:"form-label"},"產品內容物",-1),Ne={class:"mb-3"},$e={class:"form-check"},Re=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Be=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function He(l,t,n,w,o,r){const c=h("VField"),m=h("ErrorMessage"),V=h("VForm");return i(),d("div",R,[e("div",B,[e("div",H,[e("div",q,[e("h5",z,[n.isNew?(i(),d("span",O,"新增產品")):(i(),d("span",j,"編輯產品"))]),G]),a(V,{onSubmit:t[15]||(t[15]=()=>l.$emit("updateProduct"))},{default:E(({errors:u})=>[e("div",J,[e("div",K,[e("div",Q,[e("div",W,[X,e("div",Y,[Z,p(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[0]||(t[0]=s=>o.tempProduct.imageUrl=s)},null,512),[[b,o.tempProduct.imageUrl]])]),e("div",ee,[te,e("input",{class:"form-control",type:"file",id:"mainImgFile",ref:"mainImgFile",onChange:t[1]||(t[1]=(...s)=>r.uploadFile&&r.uploadFile(...s))},null,544)]),e("img",{class:"img-fluid",src:o.tempProduct.imageUrl,alt:"主要圖片"},null,8,oe)]),e("div",null,[se,Array.isArray(o.tempProduct.imagesUrl)?(i(),d(y,{key:0},[(i(!0),d(y,null,I(o.tempProduct.imagesUrl,(s,_)=>(i(),d("div",{class:"mb-2",key:_+"img"},[le,p(e("input",{type:"text",class:"form-control mb-3",placeholder:"請輸入圖片連結","onUpdate:modelValue":x=>o.tempProduct.imagesUrl[_]=x},null,8,ie),[[b,o.tempProduct.imagesUrl[_]]]),e("img",{class:"img-fluid",src:s,alt:"多圖"+(_+1)},null,8,de)]))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(i(),d("button",{key:0,type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=s=>l.$emit("createImages"))}," 新增圖片 ")):U("",!0),o.tempProduct.imagesUrl.length?(i(),d("button",{key:1,type:"button",class:"btn btn-outline-danger btn-sm mt-2 d-block w-100",onClick:t[3]||(t[3]=s=>o.tempProduct.imagesUrl.pop())}," 刪除圖片 ")):U("",!0)],64)):(i(),d("button",{key:1,type:"button",class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[4]||(t[4]=s=>l.$emit("createImages","init"))}," 新增圖片 "))])]),e("div",ae,[e("div",ne,[e("div",re,[ce,a(c,{id:"title",name:"標題",type:"text",class:g(["form-control",{"is-invalid":u.標題}]),placeholder:"請輸入標題",modelValue:o.tempProduct.title,"onUpdate:modelValue":t[5]||(t[5]=s=>o.tempProduct.title=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"標題",class:"invalid-feedback"})]),e("div",me,[ue,p(e("input",{id:"enTitle",type:"text",class:"form-control","onUpdate:modelValue":t[6]||(t[6]=s=>o.tempProduct.enTitle=s),placeholder:"請輸入英文標題"},null,512),[[b,o.tempProduct.enTitle]])])]),e("div",pe,[he,a(c,{id:"category",name:"分類",type:"text",class:g(["form-control",{"is-invalid":u.分類}]),placeholder:"請輸入分類",modelValue:o.tempProduct.category,"onUpdate:modelValue":t[7]||(t[7]=s=>o.tempProduct.category=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"分類",class:"invalid-feedback"})]),e("div",_e,[e("div",be,[ge,p(e("select",{id:"productCategory",class:"form-select","aria-label":"Product category select","onUpdate:modelValue":t[8]||(t[8]=s=>o.tempProduct.productCategory=s)},[Pe,o.tempProduct.category==="披薩"||n.isNew?(i(),d(y,{key:0},[fe,ve,ye,we],64)):U("",!0),o.tempProduct.category==="副食"||n.isNew?(i(),d(y,{key:1},[Ue,Ve],64)):U("",!0)],512),[[S,o.tempProduct.productCategory]])]),e("div",Me,[ke,a(c,{id:"unit",name:"單位",type:"text",class:g(["form-control",{"is-invalid":u.單位}]),placeholder:"請輸入單位",modelValue:o.tempProduct.unit,"onUpdate:modelValue":t[9]||(t[9]=s=>o.tempProduct.unit=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"單位",class:"invalid-feedback"})])]),e("div",Ie,[e("div",Ce,[xe,a(c,{id:"origin_price",name:"原價",type:"number",min:"0",class:g(["form-control",{"is-invalid":u.原價}]),placeholder:"請輸入原價",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":t[10]||(t[10]=s=>o.tempProduct.origin_price=s),modelModifiers:{number:!0},rules:"required|min_value:0"},null,8,["modelValue","class"]),a(m,{name:"原價",class:"invalid-feedback"})]),e("div",Le,[Te,a(c,{id:"price",name:"售價",type:"number",min:"0",class:g(["form-control",{"is-invalid":u.售價}]),placeholder:"請輸入售價",modelValue:o.tempProduct.price,"onUpdate:modelValue":t[11]||(t[11]=s=>o.tempProduct.price=s),modelModifiers:{number:!0},rules:"required|min_value:0"},null,8,["modelValue","class"]),a(m,{name:"售價",class:"invalid-feedback"})])]),Ae,e("div",Ee,[Se,p(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[12]||(t[12]=s=>o.tempProduct.description=s)},`
                  `,512),[[b,o.tempProduct.description]])]),e("div",Fe,[De,p(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品內容物","onUpdate:modelValue":t[13]||(t[13]=s=>o.tempProduct.content=s)},`
                  `,512),[[b,o.tempProduct.content]])]),e("div",Ne,[e("div",$e,[p(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[14]||(t[14]=s=>o.tempProduct.is_enabled=s)},null,512),[[F,o.tempProduct.is_enabled]]),Re])])])])]),Be]),_:1})])])],512)}const qe=k($,[["render",He]]),{VITE_APP_URL:f,VITE_APP_PATH:v}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},ze={data(){return{products:[],tempProduct:{imagesUrl:[]},isNew:!0,page:{},isLoading:!1,delModalType:"商品"}},components:{SharedPagination:L,ProductModal:qe,DelItemModal:A},methods:{...M(C,["swalShow"]),getProducts(l=1,t=""){let n=`${f}/api/${v}/admin/products/?page=${l}`;t!==""&&(n=`${f}/api/${v}/admin/products/category=${t}?&page=${l}`),this.isLoading=!0,this.$http.get(n).then(w=>{this.products=w.data.products,this.page=w.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,this.swalShow("請先登入","error"),this.$router.push("/login")})},updateProduct(){let l="post",t=`${f}/api/${v}/admin/product`;this.isNew||(l="put",t=`${f}/api/${v}/admin/product/${this.tempProduct.id}`),this.isLoading=!0,this.$http[l](t,{data:this.tempProduct}).then(n=>{this.getProducts(this.page.current_page),this.$refs.productModal.closeModal(),this.swalShow(`${n.data.message}`,"success","toast")}).catch(n=>{this.swalShow(`${n.response.data.message}`,"error"),this.isLoading=!1})},delProduct(){this.$refs.delProductModal.closeModal(),this.isLoading=!0,this.$http.delete(`${f}/api/${v}/admin/product/${this.tempProduct.id}`).then(l=>{this.getProducts(),this.swalShow(`${l.data.message}`,"success","toast")}).catch(l=>{this.swalShow(`${l.data.message}`,"error"),this.isLoading=!1})},openModal(l,t){l==="create"?(this.tempProduct={imagesUrl:[],productCategory:"無細項分類"},this.isNew=!0,this.$refs.productModal.openModal()):l==="edit"?(this.tempProduct={...t},this.isNew=!1,this.$refs.productModal.openModal()):l==="delete"&&(this.tempProduct={...t},this.$refs.delProductModal.openModal())},createImages(l){l==="init"&&(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push("")}},mounted(){this.getProducts()}},Oe={class:"text-end mt-4"},je={class:"table mt-4"},Ge=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",null,"細項分類"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),Je={class:"text-start"},Ke={class:"text-start"},Qe={key:0,class:"text-success"},We={key:1},Xe={class:"btn-group"},Ye=["onClick"],Ze=["onClick"];function et(l,t,n,w,o,r){const c=h("VueLoading"),m=h("SharedPagination"),V=h("ProductModal"),u=h("DelItemModal");return i(),d("div",null,[e("div",Oe,[e("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=s=>r.openModal("create"))}," 建立新的產品 ")]),e("table",je,[Ge,e("tbody",null,[(i(!0),d(y,null,I(o.products,s=>(i(),d("tr",{key:s.id},[e("td",null,P(s.category),1),e("td",null,P(s.title),1),e("td",null,P(s.productCategory),1),e("td",Je,P(s.origin_price),1),e("td",Ke,P(s.price),1),e("td",null,[s.is_enabled?(i(),d("span",Qe,"啟用")):(i(),d("span",We,"未啟用"))]),e("td",null,[e("div",Xe,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>r.openModal("edit",s)}," 編輯 ",8,Ye),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>r.openModal("delete",s)}," 刪除 ",8,Ze)])])]))),128))])]),a(c,{active:o.isLoading,"onUpdate:active":t[1]||(t[1]=s=>o.isLoading=s)},null,8,["active"]),a(m,{pages:o.page,onChangePage:r.getProducts},null,8,["pages","onChangePage"]),a(V,{ref:"productModal",product:o.tempProduct,"is-new":o.isNew,onUpdateProduct:r.updateProduct,onCreateImages:r.createImages},null,8,["product","is-new","onUpdateProduct","onCreateImages"]),a(u,{ref:"delProductModal","temp-item":o.tempProduct,"del-modal-type":o.delModalType,onDelItem:r.delProduct},null,8,["temp-item","del-modal-type","onDelItem"])])}const it=k(ze,[["render",et]]);export{it as default};
