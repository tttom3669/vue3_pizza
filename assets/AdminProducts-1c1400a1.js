import{S as L}from"./SharedPagination-cf5f7d13.js";import{M as A,D as E}from"./DelItemModal-8816016d.js";import{a as M,_ as k,r as p,o as i,c as d,b as e,d as a,w as S,i as h,q as w,F as v,e as I,g as U,n as b,v as T,H as F,t as g}from"./index-edab9d34.js";import{s as C}from"./swalMessage-4e4cdec7.js";import"./sweetalert2.all-b47eb5a7.js";const{VITE_APP_URL:D,VITE_APP_PATH:$}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},N={data(){return{modal:{},tempProduct:{}}},props:{product:{type:Object,default(){return{}}},isNew:{type:Boolean,default(){return!0}}},watch:{product(){this.tempProduct=this.product,this.tempProduct.imagesUrl||(this.tempProduct.imagesUrl=[])}},methods:{...M(C,["swalShow"]),openModal(){this.modal.show()},closeModal(){this.modal.hide()},uploadFile(){const l=this.$refs.mainImgFile.files[0],t=new FormData;t.append("mainImgFile",l),this.$http.post(`${D}/api/${$}/admin/upload`,t).then(n=>{this.tempProduct.imageUrl=n.data.imageUrl,this.$refs.mainImgFile.value="",this.swalShow("圖片上傳成功","success","toast")}).catch(()=>{this.swalShow("檔案格式不符","error")})}},mounted(){this.modal=new A(this.$refs.productModal)}},R={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-xl"},B={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},z={id:"productModalLabel",class:"modal-title"},O={key:0},j={key:1},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),J={class:"modal-body"},K={class:"row"},Q={class:"col-sm-4"},W={class:"mb-2"},X=e("h3",{class:"mb-3"},"主要圖片",-1),Y={class:"mb-3"},Z=e("label",{for:"imageUrl",class:"form-label"},"圖片網址",-1),ee={class:"mb-3"},te=e("label",{for:"mainImgFile",class:"form-label"},"或 上傳圖片",-1),oe=["src"],se=e("h3",{class:"mb-3"},"多圖新增",-1),le=e("label",{for:"imageUrl",class:"form-label"},"圖片網址",-1),ie=["onUpdate:modelValue"],de=["src"],ae={class:"col-sm-8"},ne={class:"mb-3"},re=e("label",{for:"title",class:"form-label"},"標題",-1),ce={class:"mb-3"},me=e("label",{for:"category",class:"form-label"},"分類",-1),ue={class:"row"},pe={class:"mb-3 col-md-6"},he=e("label",{for:"productCategory",class:"form-label"},"細項分類",-1),_e=e("option",{selected:"",disabled:"",hidden:""},"請選擇",-1),be=e("option",{value:"無肉不歡"},"無肉不歡",-1),ge=e("option",{value:"蔬食首選"},"蔬食首選",-1),Pe=e("option",{value:"海鮮至上"},"海鮮至上",-1),fe=e("option",{value:"甜食主義"},"甜食主義",-1),ve=e("option",{value:"炸物"},"炸物",-1),ye=e("option",{value:"飲料"},"飲料",-1),we={class:"mb-3 col-md-6"},Ue=e("label",{for:"price",class:"form-label"},"單位",-1),Ve={class:"row"},Me={class:"mb-3 col-md-6"},ke=e("label",{for:"origin_price",class:"form-label"},"原價",-1),Ie={class:"mb-3 col-md-6"},Ce=e("label",{for:"price",class:"form-label"},"售價",-1),xe=e("hr",null,null,-1),Le={class:"mb-3"},Ae=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ee={class:"mb-3"},Se=e("label",{for:"content",class:"form-label"},"產品內容物",-1),Te={class:"mb-3"},Fe={class:"form-check"},De=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),$e=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary"},"確認")],-1);function Ne(l,t,n,y,o,r){const c=p("VField"),m=p("ErrorMessage"),V=p("VForm");return i(),d("div",R,[e("div",q,[e("div",B,[e("div",H,[e("h5",z,[n.isNew?(i(),d("span",O,"新增產品")):(i(),d("span",j,"編輯產品"))]),G]),a(V,{onSubmit:t[14]||(t[14]=()=>l.$emit("updateProduct"))},{default:S(({errors:u})=>[e("div",J,[e("div",K,[e("div",Q,[e("div",W,[X,e("div",Y,[Z,h(e("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":t[0]||(t[0]=s=>o.tempProduct.imageUrl=s)},null,512),[[w,o.tempProduct.imageUrl]])]),e("div",ee,[te,e("input",{class:"form-control",type:"file",id:"mainImgFile",ref:"mainImgFile",onChange:t[1]||(t[1]=(...s)=>r.uploadFile&&r.uploadFile(...s))},null,544)]),e("img",{class:"img-fluid",src:o.tempProduct.imageUrl},null,8,oe)]),e("div",null,[se,Array.isArray(o.tempProduct.imagesUrl)?(i(),d(v,{key:0},[(i(!0),d(v,null,I(o.tempProduct.imagesUrl,(s,_)=>(i(),d("div",{class:"mb-2",key:_+"img"},[le,h(e("input",{type:"text",class:"form-control mb-3",placeholder:"請輸入圖片連結","onUpdate:modelValue":x=>o.tempProduct.imagesUrl[_]=x},null,8,ie),[[w,o.tempProduct.imagesUrl[_]]]),e("img",{class:"img-fluid",src:s},null,8,de)]))),128)),!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(i(),d("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[2]||(t[2]=s=>l.$emit("createImages"))}," 新增圖片 ")):U("",!0),o.tempProduct.imagesUrl.length?(i(),d("button",{key:1,class:"btn btn-outline-danger btn-sm mt-2 d-block w-100",onClick:t[3]||(t[3]=s=>o.tempProduct.imagesUrl.pop())}," 刪除圖片 ")):U("",!0)],64)):(i(),d("button",{key:1,class:"btn btn-outline-primary btn-sm d-block w-100",onClick:t[4]||(t[4]=s=>l.$emit("createImages","init"))}," 新增圖片 "))])]),e("div",ae,[e("div",ne,[re,a(c,{id:"title",name:"標題",type:"text",class:b(["form-control",{"is-invalid":u.標題}]),placeholder:"請輸入標題",modelValue:o.tempProduct.title,"onUpdate:modelValue":t[5]||(t[5]=s=>o.tempProduct.title=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"標題",class:"invalid-feedback"})]),e("div",ce,[me,a(c,{id:"category",name:"分類",type:"text",class:b(["form-control",{"is-invalid":u.分類}]),placeholder:"請輸入分類",modelValue:o.tempProduct.category,"onUpdate:modelValue":t[6]||(t[6]=s=>o.tempProduct.category=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"分類",class:"invalid-feedback"})]),e("div",ue,[e("div",pe,[he,h(e("select",{id:"productCategory",class:"form-select","aria-label":"Product category select","onUpdate:modelValue":t[7]||(t[7]=s=>o.tempProduct.productCategory=s)},[_e,o.tempProduct.category==="披薩"||n.isNew?(i(),d(v,{key:0},[be,ge,Pe,fe],64)):U("",!0),o.tempProduct.category==="副食"||n.isNew?(i(),d(v,{key:1},[ve,ye],64)):U("",!0)],512),[[T,o.tempProduct.productCategory]])]),e("div",we,[Ue,a(c,{id:"unit",name:"單位",type:"text",class:b(["form-control",{"is-invalid":u.單位}]),placeholder:"請輸入單位",modelValue:o.tempProduct.unit,"onUpdate:modelValue":t[8]||(t[8]=s=>o.tempProduct.unit=s),rules:"required"},null,8,["modelValue","class"]),a(m,{name:"單位",class:"invalid-feedback"})])]),e("div",Ve,[e("div",Me,[ke,a(c,{id:"origin_price",name:"原價",type:"number",min:"0",class:b(["form-control",{"is-invalid":u.原價}]),placeholder:"請輸入原價",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":t[9]||(t[9]=s=>o.tempProduct.origin_price=s),modelModifiers:{number:!0},rules:"required|min_value:0"},null,8,["modelValue","class"]),a(m,{name:"原價",class:"invalid-feedback"})]),e("div",Ie,[Ce,a(c,{id:"price",name:"售價",type:"number",min:"0",class:b(["form-control",{"is-invalid":u.售價}]),placeholder:"請輸入售價",modelValue:o.tempProduct.price,"onUpdate:modelValue":t[10]||(t[10]=s=>o.tempProduct.price=s),modelModifiers:{number:!0},rules:"required|min_value:0"},null,8,["modelValue","class"]),a(m,{name:"售價",class:"invalid-feedback"})])]),xe,e("div",Le,[Ae,h(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":t[11]||(t[11]=s=>o.tempProduct.description=s)},`
                  `,512),[[w,o.tempProduct.description]])]),e("div",Ee,[Se,h(e("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品內容物","onUpdate:modelValue":t[12]||(t[12]=s=>o.tempProduct.content=s)},`
                  `,512),[[w,o.tempProduct.content]])]),e("div",Te,[e("div",Fe,[h(e("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[13]||(t[13]=s=>o.tempProduct.is_enabled=s)},null,512),[[F,o.tempProduct.is_enabled]]),De])])])])]),$e]),_:1})])])],512)}const Re=k(N,[["render",Ne]]),{VITE_APP_URL:P,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},qe={data(){return{products:[],tempProduct:{imagesUrl:[]},isNew:!0,page:{},isLoading:!1,delModalType:"商品"}},components:{SharedPagination:L,ProductModal:Re,DelItemModal:E},methods:{...M(C,["swalShow"]),getProducts(l=1,t=""){let n=`${P}/api/${f}/admin/products/?page=${l}`;t!==""&&(n=`${P}/api/${f}/admin/products/category=${t}?&page=${l}`),this.isLoading=!0,this.$http.get(n).then(y=>{this.products=y.data.products,this.page=y.data.pagination,this.isLoading=!1}).catch(()=>{this.isLoading=!1,this.swalShow("請先登入","error"),this.$router.push("/login")})},updateProduct(){let l="post",t=`${P}/api/${f}/admin/product`;this.isNew||(l="put",t=`${P}/api/${f}/admin/product/${this.tempProduct.id}`),this.isLoading=!0,this.$http[l](t,{data:this.tempProduct}).then(n=>{this.getProducts(this.page.current_page),this.$refs.productModal.closeModal(),this.swalShow(`${n.data.message}`,"success","toast")}).catch(n=>{this.swalShow(`${n.response.data.message}`,"error"),this.isLoading=!1})},delProduct(){this.$refs.delProductModal.closeModal(),this.isLoading=!0,this.$http.delete(`${P}/api/${f}/admin/product/${this.tempProduct.id}`).then(l=>{this.getProducts(),this.swalShow(`${l.data.message}`,"success","toast")}).catch(l=>{this.swalShow(`${l.data.message}`,"error"),this.isLoading=!1})},openModal(l,t){l==="create"?(this.tempProduct={imagesUrl:[],productCategory:"請選擇"},this.isNew=!0,this.$refs.productModal.openModal()):l==="edit"?(this.tempProduct={...t},this.isNew=!1,this.$refs.productModal.openModal()):l==="delete"&&(this.tempProduct={...t},this.$refs.delProductModal.openModal())},createImages(l){l==="init"&&(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.push("")}},mounted(){this.getProducts()}},Be={class:"text-end mt-4"},He={class:"table mt-4"},ze=e("thead",null,[e("tr",null,[e("th",{width:"120"},"分類"),e("th",null,"產品名稱"),e("th",null,"細項分類"),e("th",{width:"120"},"原價"),e("th",{width:"120"},"售價"),e("th",{width:"100"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),Oe={class:"text-start"},je={class:"text-start"},Ge={key:0,class:"text-success"},Je={key:1},Ke={class:"btn-group"},Qe=["onClick"],We=["onClick"];function Xe(l,t,n,y,o,r){const c=p("VueLoading"),m=p("SharedPagination"),V=p("ProductModal"),u=p("DelItemModal");return i(),d("div",null,[e("div",Be,[e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=s=>r.openModal("create"))},"建立新的產品")]),e("table",He,[ze,e("tbody",null,[(i(!0),d(v,null,I(o.products,s=>(i(),d("tr",{key:s.id},[e("td",null,g(s.category),1),e("td",null,g(s.title),1),e("td",null,g(s.productCategory),1),e("td",Oe,g(s.origin_price),1),e("td",je,g(s.price),1),e("td",null,[s.is_enabled?(i(),d("span",Ge,"啟用")):(i(),d("span",Je,"未啟用"))]),e("td",null,[e("div",Ke,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:_=>r.openModal("edit",s)}," 編輯 ",8,Qe),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:_=>r.openModal("delete",s)}," 刪除 ",8,We)])])]))),128))])]),a(c,{active:o.isLoading,"onUpdate:active":t[1]||(t[1]=s=>o.isLoading=s)},null,8,["active"]),a(m,{pages:o.page,onChangePage:r.getProducts},null,8,["pages","onChangePage"]),a(V,{ref:"productModal",product:o.tempProduct,"is-new":o.isNew,onUpdateProduct:r.updateProduct,onCreateImages:r.createImages},null,8,["product","is-new","onUpdateProduct","onCreateImages"]),a(u,{ref:"delProductModal","temp-item":o.tempProduct,"del-modal-type":o.delModalType,onDelItem:r.delProduct},null,8,["temp-item","del-modal-type","onDelItem"])])}const st=k(qe,[["render",Xe]]);export{st as default};
