import{l as L,c as y}from"./cartStore-f617613f.js";import{_ as E,m as w,a as x,r as m,o as n,c,b as e,F as g,e as P,g as A,i as b,G as F,h as V,t as d,d as r,w as k,f as M,n as v,v as T}from"./index-1209f854.js";import{s as D}from"./swalMessage-9c36a4f3.js";const{VITE_APP_URL:U,VITE_APP_PATH:C}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/V2",VITE_APP_PATH:"tttom3669",BASE_URL:"/vue3_pizza/",MODE:"production",DEV:!1,PROD:!0},u=L(),B={data(){return{userForm:{user:{name:"",email:"",tel:"",address:"",paymentMethod:"信用卡",pickupMethod:"到店自取",cartDeliveryFee:0},message:""},coupon_code:""}},watch:{deliveryFee(){this.userForm.user.cartDeliveryFee=this.deliveryFee}},computed:{...w(y,["cart"]),...w(L,["isLoading"]),deliveryFee(){return this.userForm.user.pickupMethod==="到店自取"||this.cart.total>=399?0:70}},methods:{...x(D,["swalShow"]),...x(y,["getCart"]),createOrder(){const l=`${U}/api/${C}/order`,s=this.userForm;u.isLoading=!0,this.$http.post(l,{data:s}).then(i=>{const{message:f,orderId:t}=i.data;u.isLoading=!1,this.swalShow(`${f}`,"success","toast"),this.$router.push(`/checkout/${t}`)}).catch(i=>{u.isLoading=!1,this.swalShow(`${i.response.data.message}`,"error")})},addCouponCode(){const l=`${U}/api/${C}/coupon`,s={code:this.coupon_code};u.isLoading=!0,this.$http.post(l,{data:s}).then(i=>{u.isLoading=!1,this.getCart(),this.swalShow(`${i.data.message}`,"success","toast")}).catch(i=>{u.isLoading=!1,this.swalShow(`${i.response.data.message}`,"error")})}},mounted(){this.getCart()}},j={class:"bg_texture3"},q={class:"container mb-5"},G=e("div",{class:"row d-flex justify-content-center mt-3"},[e("div",{class:"col-12 col-md-6"},[e("div",{class:"col"},[e("div",{class:"position-relative m-4"},[e("div",{class:"progress",style:{height:"1px"}},[e("div",{class:"progress-bar",role:"progressbar",style:{width:"50%"},"aria-valuenow":"50","aria-valuemin":"0","aria-valuemax":"100"})]),e("div",{class:"position-absolute top-0 start-0 text-white translate-middle btn btn-sm btn-primary rounded-pill",style:{width:"2rem",height:"2rem"}}," 1 "),e("div",{class:"position-absolute top-0 start-50 text-white translate-middle btn btn-sm btn-primary rounded-pill",style:{width:"2rem",height:"2rem"}}," 2 "),e("div",{class:"position-absolute top-0 start-100 text-white translate-middle btn btn-sm btn-secondary rounded-pill",style:{width:"2rem",height:"2rem"}}," 3 ")])]),e("div",{class:"col d-flex justify-content-between text-primary fw-bold"},[e("span",{class:"ms-n1"},"確認購買"),e("span",null,"填寫資料"),e("span",{class:"text-secondary me-n1"},"完成訂單")])])],-1),O={class:"row mt-4"},R={class:"col-md-5"},$={class:"card"},z={class:"card-body"},H=e("h5",{class:"card-title"},"訂單明細",-1),J={key:0,class:"table align-middle"},K=["src"],Q={class:"p-2"},W={class:"d-flex flex-column"},X={class:"text-nowrap mb-1"},Y={class:"text-nowrap mb-1"},Z={class:"text-nowrap p-2"},ee={class:"text-nowrap p-2"},se={key:0},te=e("small",{class:"text-success"},"折扣價：",-1),oe=e("span",null,null,-1),le={key:1},ae={class:"row row-cols-2 d-flex justify-content-between"},re={class:"input-group mb-3"},de=["disabled"],ie=e("div",{class:"py-2 col text-cusGray fw-bold text-start"},"小計",-1),ne={class:"py-2 col text-cusGray fw-bold text-end"},ce=e("div",{class:"py-2 col text-cusGray fw-bold text-start"}," 運費 ",-1),ue={class:"py-2 col text-cusGray fw-bold text-end"},me=e("div",{class:"py-2 col text-success fw-bold text-start border-bottom"}," 優惠折抵 ",-1),pe={class:"py-2 col text-success fw-bold text-end border-bottom"},_e=e("div",{class:"col py-2 h5 text-cusDarkBrown fw-bold text-start"}," 總計 ",-1),he={class:"col py-2 h5 text-cusDarkBrown fw-bold text-end"},be={class:"col-md-7"},ve=e("h4",{class:"h4 text-center my-3 mt-md-0"},"訂單資訊",-1),fe={class:"row d-flex flex-row mb-3"},ye={class:"col-md-6"},we=e("label",{for:"InputUserName",class:"form-label"},"收件人姓名",-1),xe={class:"col-md-6"},ge=e("label",{for:"InputUserTel",class:"form-label"},"收件人電話",-1),Fe={class:"row mb-3"},Ve={class:"col-md-6"},ke=e("label",{for:"email",class:"form-label"},"Email",-1),Me={class:"col-md-6"},Te=e("label",{for:"paymentMethod",class:"form-label"},"付款方式",-1),Ue=e("option",{value:"信用卡"},"信用卡",-1),Ce=e("option",{value:"現金付款"},"現金付款",-1),Le=[Ue,Ce],Se={class:"row mb-3"},Ie={class:"col-md-6"},Ne=e("label",{for:"InputUserAddress",class:"form-label"},"收件人地址",-1),Ee={class:"col-md-6"},Pe=e("label",{for:"pickupMethod",class:"form-label"},"取貨方式",-1),Ae=e("option",{value:"到店自取"},"到店自取",-1),De=e("option",{value:"外送/宅配上門"},"外送/宅配上門",-1),Be=[Ae,De],je={class:"mb-3"},qe=e("label",{for:"FormControlTextarea",class:"form-label"},"備註",-1),Ge=e("div",{class:"d-flex justify-content-end"},[e("button",{type:"submit",class:"btn btn-primary text-white w-50 w-md-25"}," 下一步 ")],-1);function Oe(l,s,i,f,t,p){const S=m("router-link"),_=m("VField"),h=m("ErrorMessage"),I=m("VForm"),N=m("VueLoading");return n(),c(g,null,[e("div",j,[e("div",q,[G,e("div",O,[e("div",R,[e("div",$,[e("div",z,[H,l.cart.carts?(n(),c("table",J,[e("tbody",null,[(n(!0),c(g,null,P(l.cart.carts,o=>(n(),c("tr",{key:o.id},[e("td",null,[e("img",{src:o.product.imageUrl,alt:"",class:"object-fit-cover",height:"70",width:"70"},null,8,K)]),e("td",Q,[e("div",W,[e("div",X,[r(S,{to:`/product/${o.product.id}`,class:"text-decoration-none text-cusDarkBrown",onClick:V(()=>l.getProduct(o.product.id),["prevent"])},{default:k(()=>[M(d(o.product.title),1)]),_:2},1032,["to","onClick"])]),e("div",Y," NT$ "+d(o.product.price)+" / "+d(o.product.unit),1)])]),e("td",Z,"x "+d(o.qty),1),e("td",ee,[l.cart.final_total!==l.cart.total?(n(),c("div",se,[te,oe,M(" NT$ "+d(l.$filters.currency(o.final_total)),1)])):(n(),c("div",le,"NT$ "+d(o.total),1))])]))),128))])])):A("",!0),e("div",ae,[e("div",re,[b(e("input",{type:"text",class:"form-control",placeholder:"請輸入優惠券代碼","aria-label":"Recipient's coupon","aria-describedby":"couponInput","onUpdate:modelValue":s[0]||(s[0]=o=>t.coupon_code=o)},null,512),[[F,t.coupon_code]]),e("button",{class:"btn btn-outline-primary",type:"button",id:"couponInput",onClick:s[1]||(s[1]=V(()=>p.addCouponCode(),["prevent"])),disabled:t.coupon_code===""}," 套用優惠券碼 ",8,de)]),ie,e("div",ne," NT$ "+d(l.cart.total),1),ce,e("div",ue," +NT$ "+d(p.deliveryFee),1),me,e("div",pe," -NT$ "+d(l.cart.final_total-l.cart.total),1),_e,e("div",he," NT$ "+d(l.cart.final_total+p.deliveryFee),1)])])])]),e("div",be,[ve,r(I,{onSubmit:p.createOrder},{default:k(({errors:o})=>[e("div",fe,[e("div",ye,[we,r(_,{type:"text",name:"姓名",class:v(["form-control",{"is-invalid":o.姓名}]),rules:"required",id:"InputUserName",placeholder:"請輸入姓名",modelValue:t.userForm.user.name,"onUpdate:modelValue":s[2]||(s[2]=a=>t.userForm.user.name=a)},null,8,["class","modelValue"]),r(h,{name:"姓名",class:"invalid-feedback"})]),e("div",xe,[ge,r(_,{type:"tel",name:"電話",class:v(["form-control",{"is-invalid":o.電話}]),rules:"required|min:8|max:10",id:"InputUserTel",placeholder:"請輸入電話",modelValue:t.userForm.user.tel,"onUpdate:modelValue":s[3]||(s[3]=a=>t.userForm.user.tel=a)},null,8,["class","modelValue"]),r(h,{name:"電話",class:"invalid-feedback"})])]),e("div",Fe,[e("div",Ve,[ke,r(_,{type:"email",name:"email",class:v(["form-control",{"is-invalid":o.email}]),id:"email",rules:"email|required","aria-describedby":"emailHelp",placeholder:"請輸入 Email",modelValue:t.userForm.user.email,"onUpdate:modelValue":s[4]||(s[4]=a=>t.userForm.user.email=a)},null,8,["class","modelValue"]),r(h,{name:"email",class:"invalid-feedback"})]),e("div",Me,[Te,b(e("select",{class:"form-control",name:"paymentMethod",id:"paymentMethod","onUpdate:modelValue":s[5]||(s[5]=a=>t.userForm.user.paymentMethod=a)},Le,512),[[T,t.userForm.user.paymentMethod]])])]),e("div",Se,[e("div",Ie,[Ne,r(_,{type:"text",name:"地址",class:v([{"is-invalid":o.地址},"form-control"]),rules:"required",id:"InputUserAddress",placeholder:"請輸入地址",modelValue:t.userForm.user.address,"onUpdate:modelValue":s[6]||(s[6]=a=>t.userForm.user.address=a)},null,8,["class","modelValue"]),r(h,{name:"地址",class:"invalid-feedback"})]),e("div",Ee,[Pe,b(e("select",{class:"form-control",name:"pickupMethod",id:"pickupMethod","onUpdate:modelValue":s[7]||(s[7]=a=>t.userForm.user.pickupMethod=a)},Be,512),[[T,t.userForm.user.pickupMethod]])])]),e("div",je,[qe,b(e("textarea",{class:"form-control",id:"FormControlTextarea",placeholder:"歡迎留下想對我們說的話!",rows:"3","onUpdate:modelValue":s[8]||(s[8]=a=>t.userForm.message=a)},null,512),[[F,t.userForm.message]])]),Ge]),_:1},8,["onSubmit"])])])])]),r(N,{active:l.isLoading,"onUpdate:active":s[9]||(s[9]=o=>l.isLoading=o),loader:"dots"},null,8,["active"])],64)}const He=E(B,[["render",Oe]]);export{He as default};
